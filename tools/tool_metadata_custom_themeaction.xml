<?xml version="1.0" encoding="UTF-8"?>
<tool type="themeaction">
    <cbinfo-metadata>
        <param name="tool.help.text">Hjælpetext til custom metadatamodul</param>
    </cbinfo-metadata>

    <displayname><![CDATA[[Se temaets metadata]]]></displayname>
    <description><![CDATA[[Et værktøj til at kigge på eller editere i metadata på temaet.]]]></description>

    <src><![CDATA[[
        themeActions.registerAction(new ThemeAction({
            name: 'metadata_custom',

            actionfunction: theme => {
                theme.show()
                var dialog = new Dialog({
                    id: 'metadata_dialog',
                    title: 'Metadata',
                    resizable: {
                        x: true,
                        y: false
                    },
                    minwidth: 300
                })

                var ds = spm.getSession().getDatasource('ds_metadata')

                ds.execute({command: 'read-metadata-for-theme', tema: theme.name}, resp => {
                    var metadata = resp[0]
                    console.log(metadata)
                    var html = `
                        <h2>${theme._displayname}</h2><br>
                        <div style="display: grid;">
                            <label for="ansvarlig">Ansvarlig</label>
                            <input style="cursor: not-allowed;" type="text" id="ansvarlig" readonly>

                            <label for="email">Email</label>
                            <input style="cursor: not-allowed;" type="text" id="email" readonly>

                            <label for="afdeling">Afdeling</label>
                            <input style="cursor: not-allowed;" type="text" id="afdeling" readonly>

                            <label for="center">Center</label>
                            <input style="cursor: not-allowed;" type="text" id="center" readonly>

                            <label for="beskrivelse">Beskrivelse</label>
                            <textarea id="beskrivelse" name="beskrivelse" readonly style="width: 100%; resize: none; cursor: not-allowed" rows="5">${metadata.beskrivelse}</textarea>

                            <label for="status">Status</label>
                            <input style="cursor: not-allowed;" type="text" id="status" readonly>

                            <label for="frekvens">Ajourføringsfrekvens</label>
                            <input style="cursor: not-allowed;" type="text" id="frekvens" readonly>

                            <label for="metadata_dato">Metadata dato</label>
                            <input style="cursor: not-allowed;" type="text" id="metadata_dato" readonly>
                        </div>`
                    dialog.addContentHTML(html)
                    
                    document.getElementById('ansvarlig').value = metadata.kontakt_person;
                    document.getElementById('email').value = metadata.kontakt_email;
                    document.getElementById('afdeling').value = metadata.afdeling;
                    document.getElementById('center').value = metadata.center;
                    document.getElementById('status').value = metadata.status;
                    document.getElementById('frekvens').value = metadata.frekvens;
                    document.getElementById('metadata_dato').value = metadata.opret_dato;
                })


                dialog.addButtonsHTML("<div style='text-align: right;'><button>Do it</button></div>")
                
                dialog.showDialog()

            },

            conditionfunction: theme => {
                if (typeof(theme.getMetadata('metadata.url')) == 'undefined') {
                    return true
                }
            },

            buttonoptions: {
                tooltip: 'Se metadata for tema'
            }
        }))
    ]]]></src>
    

</tool>